<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Census 2027 â€” Malavalli Taluk</title>
<style>
/* â”€â”€ Google Fonts inline fallback â€” loaded async so blank page never happens â”€â”€ */
@import url('https://fonts.googleapis.com/css2?family=Mukta:wght@400;600;700&family=Noto+Serif:wght@700&display=swap');

*{box-sizing:border-box;margin:0;padding:0}
html,body{min-height:100vh}
body{font-family:'Mukta',Arial,sans-serif;background:#eef2f7;color:#1e293b}

/* â•â•â•â• HEADER â•â•â•â• */
.hdr{background:linear-gradient(90deg,#1b3d6e,#0f2548);border-bottom:3px solid #c9a227;position:sticky;top:0;z-index:100}
.hdr-in{max-width:1200px;margin:0 auto;padding:11px 18px;display:flex;align-items:center;gap:12px}
.hdr-seal{width:44px;height:44px;background:radial-gradient(circle,#d4aa30,#a07818);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;box-shadow:0 0 0 3px rgba(212,170,48,.25)}
.hdr-txt h1{font-family:'Noto Serif',Georgia,serif;color:#fff;font-size:15px;font-weight:700;line-height:1.3}
.hdr-txt p{color:#8aadd4;font-size:11px;margin-top:1px}
.hdr-badge-wrap{margin-left:auto;text-align:right;flex-shrink:0}
.hdr-badge{background:rgba(201,162,39,.18);border:1px solid #c9a227;color:#e8c84a;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;display:inline-block}
.hdr-uname{color:#8aadd4;font-size:11px;margin-top:3px}

/* â•â•â•â• PAGE WRAPPER â•â•â•â• */
.page{max-width:1200px;margin:0 auto;padding:20px 16px}

/* â•â•â•â• LOGIN â•â•â•â• */
.login-wrap{max-width:420px;margin:50px auto}
.login-card{background:#fff;border-radius:14px;box-shadow:0 20px 60px rgba(15,37,72,.22);overflow:hidden}
.login-top{background:linear-gradient(135deg,#1b3d6e,#0f2548);padding:26px;text-align:center;border-bottom:3px solid #c9a227}
.login-ico{font-size:36px;margin-bottom:8px}
.login-top h2{font-family:'Noto Serif',Georgia,serif;color:#fff;font-size:18px;font-weight:700}
.login-top p{color:#8aadd4;font-size:12px;margin-top:3px}
.login-body{padding:24px}
.rtabs{display:flex;gap:5px;background:#f1f5f9;border-radius:8px;padding:4px;margin-bottom:20px}
.rtab{flex:1;padding:9px;border:none;border-radius:6px;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;background:transparent;color:#64748b;transition:all .2s}
.rtab.on{background:#1b3d6e;color:#fff;box-shadow:0 2px 8px rgba(27,61,110,.3)}
.flbl{display:block;font-size:11px;font-weight:700;color:#475569;text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px}
.fgrp{margin-bottom:15px}
.fsel,.finp{width:100%;padding:10px 12px;border:1.5px solid #e2e8f0;border-radius:7px;font-family:inherit;font-size:14px;color:#1e293b;outline:none;background:#fff;transition:border-color .2s,box-shadow .2s}
.fsel:focus,.finp:focus{border-color:#1b3d6e;box-shadow:0 0 0 3px rgba(27,61,110,.1)}
.err-box{background:#fee2e2;border:1px solid #fca5a5;color:#dc2626;padding:9px 12px;border-radius:7px;font-size:13px;margin-bottom:14px;display:none}
.err-box.show{display:block}
.btn-login{width:100%;padding:11px;background:linear-gradient(135deg,#1b3d6e,#0d4a8c);color:#fff;border:none;border-radius:8px;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;letter-spacing:.3px;margin-top:4px;transition:all .2s}
.btn-login:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(27,61,110,.32)}
.btn-login:active{transform:translateY(0)}

/* â•â•â•â• LAYOUT â•â•â•â• */
.layout{display:grid;grid-template-columns:255px 1fr;gap:18px;align-items:start}
@media(max-width:700px){.layout{grid-template-columns:1fr}}

/* â•â•â•â• SIDEBAR â•â•â•â• */
.sb{background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.1);overflow:hidden;position:sticky;top:72px}
.sb-hd{background:linear-gradient(135deg,#1b3d6e,#0f2548);padding:14px 16px;border-bottom:2px solid #c9a227}
.sb-hd h3{font-family:'Noto Serif',Georgia,serif;color:#fff;font-size:14px;font-weight:700}
.sb-hd p{color:#8aadd4;font-size:11px;margin-top:2px}
.sb-bd{padding:14px 15px}
.irow{display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid #f1f5f9;font-size:12px}
.irow:last-child{border-bottom:none}
.ilbl{color:#64748b}
.ival{color:#1e293b;font-weight:700}
.ival.done{color:#15803d}
.ival.pend{color:#d97706}
.pb-info{display:flex;justify-content:space-between;font-size:11px;color:#64748b;margin:11px 0 4px}
.pbar{height:7px;background:#e2e8f0;border-radius:4px;overflow:hidden}
.pfill{height:100%;background:linear-gradient(90deg,#16a34a,#22c55e);border-radius:4px;transition:width .5s ease;width:0%}
.sbt{margin-top:13px;padding-top:12px;border-top:1px solid #e8edf3}
.sbt-title{font-size:10px;font-weight:700;color:#475569;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}
.sheet-status{font-size:12px;font-weight:600;display:flex;align-items:center;gap:7px;padding:9px 11px;border-radius:7px}
.sheet-status.ok{background:#f0fdf4;color:#15803d;border:1px solid #bbf7d0}
.sheet-status.no{background:#fff7ed;color:#9a3412;border:1px solid #fed7aa}
.dot{width:8px;height:8px;border-radius:50%;display:inline-block;flex-shrink:0}
.dot-ok{background:#16a34a}
.dot-err{background:#dc2626}
.dot-spin{background:#eab308;animation:spin .7s infinite}
@keyframes spin{0%,100%{opacity:1}50%{opacity:.25}}
.btn-out{width:100%;padding:9px;background:#fee2e2;color:#dc2626;border:1px solid #fca5a5;border-radius:6px;font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;margin-top:14px;transition:all .2s}
.btn-out:hover{background:#dc2626;color:#fff}

/* â•â•â•â• CONTENT â•â•â•â• */
.content{display:flex;flex-direction:column;gap:14px}
.ctop{background:#fff;border-radius:12px;padding:17px 20px;box-shadow:0 4px 20px rgba(0,0,0,.1)}
.ctop h2{font-family:'Noto Serif',Georgia,serif;color:#1b3d6e;font-size:16px;font-weight:700}
.ctop p{color:#64748b;font-size:12px;margin-top:3px}
.stag{font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px;margin-top:8px;display:inline-flex;align-items:center;gap:5px}
.stag.ok{background:#dcfce7;color:#15803d}
.stag.no{background:#fee2e2;color:#dc2626}

/* â•â•â•â• TABLE â•â•â•â• */
.tbl-wrap{background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.1);overflow:auto;max-height:calc(100vh - 220px)}
table{width:100%;border-collapse:collapse;min-width:740px}
thead{background:linear-gradient(135deg,#1b3d6e,#0f2548);position:sticky;top:0;z-index:5}
thead th{padding:11px 11px;text-align:left;font-size:10px;font-weight:700;color:#8aadd4;text-transform:uppercase;letter-spacing:.5px;border-right:1px solid rgba(255,255,255,.07);white-space:nowrap}
thead th:last-child{border-right:none}
tbody td{padding:9px 11px;font-size:13px;color:#334155;vertical-align:middle}

/* Village rows */
tr.vrow{background:#fff;border-bottom:1px solid #e8edf3;transition:background .1s}
tr.vrow:hover{background:#f8fafc}
tr.vrow.sv{background:#f0fdf4}
/* Dakale rows */
tr.drow{background:#faf7ff;border-bottom:1px solid #ede9fe;transition:background .1s}
tr.drow:hover{background:#f3eeff}
tr.drow.sv{background:#f0fdf4}

/* Cells */
.sno-b{background:#e2e8f0;color:#475569;width:24px;height:24px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-size:10px;font-weight:700}
.arr{color:#a78bfa;font-size:16px;font-weight:700}
.vname{font-weight:700;color:#1e293b;font-size:13px}
.dk-sub{font-size:10px;color:#a78bfa;margin-top:2px}
.dk-row{display:flex;align-items:center;gap:7px}
.dk-dash{border-top:2px dashed #a78bfa;width:16px;flex-shrink:0}
.dk-lbl{font-weight:700;color:#5b21b6;font-size:13px}
.dk-tag{background:#ede9fe;color:#5b21b6;padding:1px 6px;border-radius:3px;font-size:9px;font-weight:700;letter-spacing:.3px;margin-left:3px}
.gp-b{background:#dbeafe;color:#1d4ed8;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:700;white-space:nowrap;display:inline-block}
.code-txt{font-family:'Courier New',monospace;font-size:11px;color:#94a3b8}

/* Number input */
.ni{width:128px;padding:7px 9px;border:1.5px solid #e2e8f0;border-radius:6px;font-family:inherit;font-size:13px;color:#1e293b;outline:none;text-align:right;transition:border-color .2s,box-shadow .2s;-moz-appearance:textfield;appearance:textfield}
.ni::-webkit-outer-spin-button,.ni::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
.ni:focus{border-color:#1b3d6e;box-shadow:0 0 0 3px rgba(27,61,110,.1)}
.ni.hv{border-color:#16a34a;background:#f0fdf4}

/* Save cell */
.sc{display:flex;align-items:center;gap:6px}
.sv-btn{padding:5px 13px;background:#1b3d6e;color:#fff;border:none;border-radius:6px;font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap;transition:background .2s}
.sv-btn:hover{background:#0d4a8c}
.sv-btn:active{background:#0a3a7a}
.sv-btn.dim{opacity:.3;cursor:default}
.sv-btn.dim:hover{background:#1b3d6e}
.tick{color:#16a34a;font-size:18px}

/* â•â•â•â• FOOTER â•â•â•â• */
.footer{text-align:center;padding:22px 16px;margin-top:8px;border-top:1px solid #e2e8f0;color:#64748b;font-size:11px;line-height:1.7}
.footer strong{color:#1b3d6e;font-weight:700}
.footer .copy{color:#94a3b8;font-size:10px;margin-top:2px}

/* â•â•â•â• TOAST â•â•â•â• */
#toast{position:fixed;bottom:20px;right:20px;padding:11px 18px;border-radius:9px;font-size:13px;font-weight:600;box-shadow:0 8px 28px rgba(0,0,0,.22);z-index:9999;display:flex;align-items:center;gap:8px;opacity:0;transform:translateY(12px);transition:all .25s ease;pointer-events:none;max-width:320px}
#toast.show{opacity:1;transform:translateY(0)}
#toast.ok{background:#15803d;color:#fff}
#toast.err{background:#dc2626;color:#fff}
#toast.info{background:#1b3d6e;color:#fff}

/* â•â•â•â• HIDDEN â•â•â•â• */
.hidden{display:none!important}
</style>
</head>
<body>

<!-- â•â•â•â• HEADER â•â•â•â• -->
<header class="hdr">
  <div class="hdr-in">
    <div class="hdr-seal">ğŸ›ï¸</div>
    <div class="hdr-txt">
      <h1>Census 2027 â€” Village Population Data Entry</h1>
      <p>Malavalli Taluk Â· Mandya District Â· Karnataka Government</p>
    </div>
    <div class="hdr-badge-wrap hidden" id="hdr-meta">
      <div class="hdr-badge" id="hdr-role-badge"></div>
      <div class="hdr-uname" id="hdr-uname"></div>
    </div>
  </div>
</header>

<!-- â•â•â•â• LOGIN PAGE â•â•â•â• -->
<div class="page" id="login-page">
  <div class="login-wrap">
    <div class="login-card">
      <div class="login-top">
        <div class="login-ico">ğŸ”</div>
        <h2>Secure Login Portal</h2>
        <p>Authorized Personnel Only Â· Census 2027</p>
      </div>
      <div class="login-body">
        <div class="rtabs">
          <button class="rtab on" id="tab-vao" onclick="switchTab('vao')">ğŸ‘¤ VAO</button>
          <button class="rtab" id="tab-sec" onclick="switchTab('secretary')">ğŸ¢ GP Secretary</button>
        </div>
        <div class="err-box" id="login-err"></div>
        <div class="fgrp">
          <label class="flbl" id="sel-label">VAO Name</label>
          <select class="fsel" id="name-sel"><option value="">-- Select --</option></select>
        </div>
        <div class="fgrp">
          <label class="flbl">Password</label>
          <input class="finp" type="password" id="pwd-inp" placeholder="Enter password" onkeydown="if(event.key==='Enter')doLogin()"/>
        </div>
        <button class="btn-login" onclick="doLogin()">Login â†’</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â• ENTRY PAGE â•â•â•â• -->
<div class="page hidden" id="entry-page">
  <div class="layout">

    <!-- Sidebar -->
    <div class="sb">
      <div class="sb-hd">
        <h3 id="sb-title">ğŸ‘¤ VAO Panel</h3>
        <p id="sb-name"></p>
      </div>
      <div class="sb-bd">
        <div class="irow"><span class="ilbl">Role</span><span class="ival" id="sb-role"></span></div>
        <div class="irow"><span class="ilbl">Villages</span><span class="ival" id="sb-villages"></span></div>
        <div class="irow"><span class="ilbl">Total Rows</span><span class="ival" id="sb-total"></span></div>
        <div class="irow"><span class="ilbl">Completed</span><span class="ival" id="sb-done"></span></div>
        <div class="pb-info"><span>Progress</span><span id="pb-pct">0%</span></div>
        <div class="pbar"><div class="pfill" id="pfill"></div></div>
        <div class="sbt">
          <div class="sbt-title">â˜ï¸ Google Sheets</div>
          <div class="sheet-status ok hidden" id="sheet-ok">
            <span class="dot dot-ok"></span>Connected â€” auto-saving
          </div>
          <div class="sheet-status no" id="sheet-no">
            <span class="dot dot-err"></span>Not configured yet
          </div>
        </div>
        <button class="btn-out" onclick="doLogout()">â† Logout</button>
      </div>
    </div>

    <!-- Content -->
    <div class="content">
      <div class="ctop">
        <h2 id="ctop-title"></h2>
        <p id="ctop-sub"></p>
        <span class="stag ok hidden" id="stag-ok"><span class="dot dot-ok"></span>Auto-saving to Google Sheets on every Save</span>
        <span class="stag no" id="stag-no"><span class="dot dot-err"></span>Google Sheets not configured â€” contact admin</span>
      </div>

      <div class="tbl-wrap">
        <table>
          <thead>
            <tr>
              <th style="width:36px">#</th>
              <th>Code</th>
              <th>Village / Dakale Grama</th>
              <th id="th-gp">GP Name</th>
              <th id="th-pop">Present Population</th>
              <th id="th-hh">Total House Holds</th>
              <th style="width:90px">Save</th>
            </tr>
          </thead>
          <tbody id="tbl-body"></tbody>
        </table>
      </div>
    </div>

  </div>

  <!-- Footer -->
  <div class="footer">
    <div><strong>Â© 2027 Census Data Entry System</strong></div>
    <div>Designed and Developed by <strong>Gangadhar</strong> Â· Statistical Inspector</div>
    <div>Taluk Office Malavalli, Mandya District Â· Karnataka Government</div>
    <div class="copy">All rights reserved Â· For official use only</div>
  </div>
</div>

<!-- Toast -->
<div id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–¼â–¼â–¼  ADMIN: PASTE YOUR GOOGLE APPS SCRIPT URL BELOW  â–¼â–¼â–¼
const SHEET_URL = "PASTE_YOUR_APPS_SCRIPT_URL_HERE";
// â–²â–²â–²  Only change the above line â€” nothing else needed  â–²â–²â–²
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const PASSWORD     = "Mal@1234";
const SHEET_READY  = SHEET_URL && SHEET_URL !== "https://script.google.com/macros/s/AKfycbx6ABy75mSbz9bd8bzVK7SgaL7SfyfcgYMlrMhAe5DXAK4R9k623UyC3UHIN9iir2wvMA/exec";

// â”€â”€ Village data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RAW = [
  {sno:1,code:614654,name:"Chikkamulagudu",dk:"Vaddara Kaloni",vao:"SHAFI",gp:"Chikkamulagudu"},
  {sno:2,code:649474,name:"Kurubanapura",dk:"",vao:"SHAFI",gp:"Chikkamulagudu"},
  {sno:3,code:614655,name:"Veerajipura",dk:"",vao:"MANJUNATH M V",gp:"Mikkere"},
  {sno:4,code:614656,name:"Maganahalli",dk:"",vao:"KAVYA",gp:"Mikkere"},
  {sno:5,code:614657,name:"Mikkere",dk:"",vao:"MANJUNATH M V",gp:"Mikkere"},
  {sno:6,code:614658,name:"Ramandur",dk:"Chunchagowdanakoppalu",vao:"MANJUNATH M V",gp:"Mikkere"},
  {sno:7,code:614659,name:"Anasale",dk:"Ramanathamole",vao:"SHAFI",gp:"Chikkamulagudu"},
  {sno:8,code:649529,name:"Halladakoppalu",dk:"",vao:"SHAFI",gp:"Chikkamulagudu"},
  {sno:9,code:614660,name:"Bheemanahalli",dk:"",vao:"GURURAJ",gp:"Chikkamulagudu"},
  {sno:10,code:614661,name:"Hittanahalli",dk:"1)Hittanahalli Koppalu 2)Budukegowdanadoddi",vao:"GURURAJ",gp:"Hittanahalli"},
  {sno:11,code:614662,name:"Dugganahalli",dk:"1)Hanchipura 2)Muddegowdanadoddi",vao:"KAVADI DHANANJAYA",gp:"Dugganahalli"},
  {sno:12,code:614663,name:"Devipura",dk:"Jayachamarajapura",vao:"PRAKASHA",gp:"Talagavadi"},
  {sno:13,code:614664,name:"Thalagavadi",dk:"",vao:"PRAKASHA",gp:"Talagavadi"},
  {sno:14,code:614665,name:"Kagepura",dk:"",vao:"PRAKASHA",gp:"Talagavadi"},
  {sno:15,code:614666,name:"Koregala",dk:"",vao:"AKSHAY KUMAR",gp:"Settihalli"},
  {sno:16,code:614667,name:"Maganur",dk:"Maganuru Kaloni",vao:"AKSHAY KUMAR",gp:"Settihalli"},
  {sno:17,code:614668,name:"Settahalli",dk:"",vao:"AKSHAY KUMAR",gp:"Settihalli"},
  {sno:18,code:614669,name:"Muganakoppalu",dk:"",vao:"HANAMANTARAYA BOGONDI",gp:"Lingapatna"},
  {sno:19,code:614670,name:"Ganiganapura",dk:"",vao:"JAYANTH B N",gp:"Bandur"},
  {sno:20,code:614671,name:"Sasiyalapura",dk:"Gattikoppalu",vao:"JAYANTH B N",gp:"Bandur"},
  {sno:21,code:614672,name:"Madahalli",dk:"",vao:"KAVADI DHANANJAYA",gp:"Dugganahalli"},
  {sno:22,code:614673,name:"Hullegala",dk:"",vao:"KAVADI DHANANJAYA",gp:"Dugganahalli"},
  {sno:23,code:614674,name:"Bandurukaval",dk:"",vao:"AKSHAY KUMAR",gp:"Settihalli"},
  {sno:24,code:614675,name:"Banduru",dk:"Dadadapura",vao:"JAYANTH B N",gp:"Bandur"},
  {sno:25,code:614676,name:"Kallarepura",dk:"",vao:"HANAMANTARAYA BOGONDI",gp:"Bandur"},
  {sno:26,code:614677,name:"Nenanuru",dk:"",vao:"PRATHIMA SM",gp:"Sujjalur"},
  {sno:27,code:614678,name:"Markalu",dk:"1)Kodenakoppalu 2)Aladahalli",vao:"PRATHIMA SM",gp:"Hittanahalli"},
  {sno:28,code:651553,name:"Jadaganapura",dk:"",vao:"PRATHIMA SM",gp:"Hittanahalli"},
  {sno:29,code:614679,name:"Doranahalli",dk:"",vao:"GURURAJ",gp:"Mikkere"},
  {sno:30,code:614680,name:"Kirugavalu",dk:"Chikkegowdanadoddi",vao:"SHAFI",gp:"Kirugavalu"},
  {sno:31,code:614681,name:"Deshavalli",dk:"",vao:"KAVYA",gp:"Bendaravadi"},
  {sno:32,code:614682,name:"Bendaravadi",dk:"",vao:"KAVYA",gp:"Bendaravadi"},
  {sno:33,code:614683,name:"Honaganahalli",dk:"",vao:"ANIL JAMAKHANDI",gp:"Kalkuni"},
  {sno:34,code:614684,name:"Kalkuni",dk:"1)Puttegowdanakoppalu 2)Chikkamaligekoppalu",vao:"ANIL JAMAKHANDI",gp:"Kalkuni"},
  {sno:35,code:651353,name:"Doddegowdanakoppalu",dk:"",vao:"ANIL JAMAKHANDI",gp:"Kalkuni"},
  {sno:36,code:614685,name:"Huvinakoppalu",dk:"",vao:"ANIL JAMAKHANDI",gp:"Sujjalur"},
  {sno:37,code:614686,name:"Sujjalur",dk:"1)Channapillekoppalu 2)Nanjegowdanadoddi",vao:"ANIL JAMAKHANDI",gp:"Sujjalur"},
  {sno:38,code:651447,name:"Samshettipura",dk:"",vao:"ANIL JAMAKHANDI",gp:"Sujjalur"},
  {sno:39,code:614687,name:"Uppanahalli",dk:"",vao:"HANAMANTARAYA BOGONDI",gp:"Settihalli"},
  {sno:40,code:614688,name:"Yamadurukaval",dk:"",vao:"HANAMANTARAYA BOGONDI",gp:"Ragibommanahalli"},
  {sno:41,code:614689,name:"Yamaduru",dk:"",vao:"HANAMANTARAYA BOGONDI",gp:"Ragibommanahalli"},
  {sno:42,code:614690,name:"Ragibommanahalli",dk:"Hucchanadoddi",vao:"HANAMANTARAYA BOGONDI",gp:"Ragibommanahalli"},
  {sno:43,code:614691,name:"Ganaganuru",dk:"",vao:"PUNEETH KUMAR N",gp:"Ragibommanahalli"},
  {sno:44,code:614692,name:"Hangrapura",dk:"",vao:"PUNEETH KUMAR N",gp:"Ragibommanahalli"},
  {sno:45,code:614693,name:"Avverahalli",dk:"Vadakepura",vao:"PUNEETH KUMAR N",gp:"Ragibommanahalli"},
  {sno:46,code:614694,name:"Kebbepura",dk:"",vao:"PUNEETH KUMAR N",gp:"Sujjalur"},
  {sno:47,code:614695,name:"Maliyur",dk:"Uppagerikoppalu",vao:"PUNEETH KUMAR N",gp:"Sujjalur"},
  {sno:48,code:651355,name:"Nelligere",dk:"",vao:"PUNEETH KUMAR N",gp:"Sujjalur"},
  {sno:49,code:614696,name:"Hanakola",dk:"",vao:"PUNEETH KUMAR N",gp:"Sujjalur"},
  {sno:50,code:614697,name:"Basavana Halli",dk:"",vao:"PUNEETH KUMAR N",gp:"Purigali"},
  {sno:51,code:614698,name:"Surakahalli",dk:"",vao:"PUNEETH KUMAR N",gp:"Purigali"},
  {sno:52,code:614699,name:"Nelamakanahalli",dk:"",vao:"CHAITHRA K",gp:"Nelamakanahalli"},
  {sno:53,code:654905,name:"Hombegowdanadoddi",dk:"",vao:"CHAITHRA K",gp:"Nelamakanahalli"},
  {sno:54,code:654906,name:"Bhugathagahalli",dk:"",vao:"CHAITHRA K",gp:"Nelamakanahalli"},
  {sno:55,code:614700,name:"Appugowdana Halli",dk:"Kalakempanadoddi",vao:"CHAITHRA K",gp:"Nelamakanahalli"},
  {sno:56,code:651356,name:"Nelluru",dk:"",vao:"CHAITHRA K",gp:"Nelamakanahalli"},
  {sno:57,code:614701,name:"Kaluveeranahalli",dk:"Moledoddi",vao:"USMAN BHASHA",gp:"Kandegala"},
  {sno:58,code:614702,name:"Kandegala",dk:"",vao:"USMAN BHASHA",gp:"Kandegala"},
  {sno:59,code:614703,name:"Gulagatta",dk:"",vao:"USMAN BHASHA",gp:"Nelamakanahalli"},
  {sno:60,code:614704,name:"Malavalli(Rural)",dk:"Tammadahalli",vao:"NANDEESH",gp:"Marehalli"},
  {sno:61,code:614705,name:"Nidaghatta",dk:"Kyathegowdanadoddi",vao:"MADEVI J",gp:"Nidaghatta"},
  {sno:62,code:651360,name:"Cholanahalli",dk:"",vao:"MADEVI J",gp:"Nidaghatta"},
  {sno:63,code:614706,name:"Ankanahalli",dk:"Anchedoddi",vao:"NATARAJ B",gp:"Kandegala"},
  {sno:64,code:614707,name:"Gowdagere",dk:"",vao:"SIDRAMAPPA",gp:"Nidaghatta"},
  {sno:65,code:614708,name:"Amrutheswaranahalli",dk:"",vao:"SIDRAMAPPA",gp:"Kandegala"},
  {sno:66,code:614709,name:"Kembuthagere",dk:"K. Annahalli",vao:"SIDRAMAPPA",gp:"Agasnapura"},
  {sno:67,code:614710,name:"Sahalli",dk:"",vao:"SIDRAMAPPA",gp:"Agasnapura"},
  {sno:68,code:614711,name:"Hadli",dk:"",vao:"RAVEESH M",gp:"Haadli"},
  {sno:69,code:614712,name:"Kodipura",dk:"",vao:"RAVEESH M",gp:"Agasnapura"},
  {sno:70,code:614713,name:"Koonanapura",dk:"",vao:"RAVEESH M",gp:"Haadli"},
  {sno:71,code:614714,name:"Jogipura",dk:"",vao:"SHIVAPPA DAMANALA",gp:"Agasnapura"},
  {sno:72,code:614715,name:"Agasanapura",dk:"",vao:"SHIVAPPA DAMANALA",gp:"Agasnapura"},
  {sno:73,code:614716,name:"Banagahalli",dk:"",vao:"SHIVASHANKAR B JAMAKANDI",gp:"Huskur"},
  {sno:74,code:614717,name:"Chandupura",dk:"",vao:"SHIVASHANKAR B JAMAKANDI",gp:"Huskur"},
  {sno:75,code:614718,name:"M.Shivapura",dk:"",vao:"ABHIJITH N L",gp:"Yathambadi"},
  {sno:76,code:614719,name:"Huskur",dk:"1)Hucchegowdanadoddi 2)Appajayanadoddi 3)Kulumedoddi 4)Siddapura",vao:"SHIVASHANKAR B JAMAKANDI",gp:"Huskur"},
  {sno:77,code:614720,name:"Kaladevanahalli",dk:"",vao:"KENCHAPPA KODLIWWAD",gp:"Yathambadi"},
  {sno:78,code:614721,name:"Hosapura",dk:"Gollaradoddi",vao:"ABHIJITH N L",gp:"Yathambadi"},
  {sno:79,code:614722,name:"Aslishivapura",dk:"",vao:"ABHIJITH N L",gp:"Yathambadi"},
  {sno:80,code:614723,name:"Belathur",dk:"",vao:"ABHIJITH N L",gp:"Yathambadi"},
  {sno:81,code:614724,name:"Yethambadi",dk:"",vao:"ABHIJITH N L",gp:"Yathambadi"},
  {sno:82,code:614725,name:"Antharavalli",dk:"",vao:"KENCHAPPA KODLIWWAD",gp:"Yathambadi"},
  {sno:83,code:614726,name:"Hullahalli",dk:"",vao:"SHIVASHANKAR B JAMAKANDI",gp:"Yathambadi"},
  {sno:84,code:614727,name:"Channipura",dk:"",vao:"RAVEESH M",gp:"D.Halasahalli"},
  {sno:85,code:614728,name:"Hullagala",dk:"",vao:"SHIVASHANKAR B JAMAKANDI",gp:"Huskur"},
  {sno:86,code:614729,name:"Dadamahalli",dk:"",vao:"KENCHAPPA KODLIWWAD",gp:"Yathambadi"},
  {sno:87,code:614730,name:"Kiragasur",dk:"",vao:"KENCHAPPA KODLIWWAD",gp:"Yathambadi"},
  {sno:88,code:614731,name:"Banasamudra",dk:"",vao:"BHASKAR S",gp:"D.Halasahalli"},
  {sno:89,code:614732,name:"Kaggalipura",dk:"",vao:"BHASKAR S",gp:"D.Halasahalli"},
  {sno:90,code:614733,name:"Konnapura",dk:"",vao:"BHASKAR S",gp:"D.Halasahalli"},
  {sno:91,code:614734,name:"Halasahalli",dk:"",vao:"BHASKAR S",gp:"D.Halasahalli"},
  {sno:92,code:614735,name:"Dhanagur",dk:"",vao:"SHIVAPPA DAMANALA",gp:"Dhanaguru"},
  {sno:93,code:614736,name:"Linganapura",dk:"",vao:"SUDARSHAN KUMAR PS",gp:"Haadli"},
  {sno:94,code:614737,name:"Gramadevathepura",dk:"",vao:"SUDARSHAN KUMAR PS",gp:"Dhanaguru"},
  {sno:95,code:614738,name:"Basavanpura",dk:"",vao:"RAVEESH M",gp:"D.Halasahalli"},
  {sno:96,code:614739,name:"Nadakalapura",dk:"Nanjegowdanadoddi",vao:"SUDARSHAN KUMAR PS",gp:"Haadli"},
  {sno:97,code:614740,name:"Megalapura",dk:"",vao:"PRAVEEN KUMAR M",gp:"Haadli"},
  {sno:98,code:614741,name:"Kamsagara",dk:"",vao:"PRAVEEN KUMAR M",gp:"Haadli"},
  {sno:99,code:614742,name:"Thuraganur",dk:"",vao:"PRAVEEN KUMAR M",gp:"Haadli"},
  {sno:100,code:614743,name:"Attuvanahalli",dk:"",vao:"SUDARSHAN KUMAR PS",gp:"Haadli"},
  {sno:101,code:614744,name:"Alada Halli",dk:"",vao:"PRAVEEN KUMAR M",gp:"Haadli"},
  {sno:102,code:614745,name:"Gajanur",dk:"Sunnadadoddi",vao:"MADEVI J",gp:"Nidaghatta"},
  {sno:103,code:614746,name:"Voddarahalli",dk:"1)Channegowdanadoddi 2)Annekoppalu",vao:"NATARAJ B",gp:"Marehalli"},
  {sno:104,code:614747,name:"Marehalli",dk:"1)Bosegowdanadoddi 2)Nagegowdanadoddi",vao:"NATARAJ B",gp:"Marehalli"},
  {sno:105,code:614748,name:"Ravani",dk:"Lakshmipuradoddi",vao:"MALLESH KP",gp:"Kyathnahalli"},
  {sno:106,code:614749,name:"Devalinganapura",dk:"",vao:"NATARAJ B",gp:"Marehalli"},
  {sno:107,code:614750,name:"Savandipura",dk:"",vao:"NARASAPPA",gp:"Nitturu"},
  {sno:108,code:614751,name:"Sagyasaragur",dk:"1)Honnemaradadoddi 2)Siddapura Kaloni",vao:"NARASAPPA",gp:"Nitturu"},
  {sno:109,code:614752,name:"Nitturhalasahalli",dk:"",vao:"NARASAPPA",gp:"Nitturu"},
  {sno:110,code:614753,name:"Kunthur",dk:"",vao:"NARASAPPA",gp:"Lingapatna"},
  {sno:111,code:614754,name:"Lingapatna",dk:"1)Naripura 2)Moogegowdanadoddi",vao:"SOMASHEKAR P",gp:"Lingapatna"},
  {sno:112,code:614755,name:"Nittur",dk:"1)N Hosadoddi 2)Kumbegowdanadoddi",vao:"SIDDARAYAMALI",gp:"Nitturu"},
  {sno:113,code:658634,name:"B Hosuru",dk:"",vao:"SIDDARAYAMALI",gp:"Nitturu"},
  {sno:114,code:614756,name:"Ankanahalli",dk:"Buyyanadoddi",vao:"SIDDARAYAMALI",gp:"Nitturu"},
  {sno:115,code:614757,name:"Maragowdanahalli",dk:"1)Kuntanadoddi 2)Heggodlu",vao:"SOMANNA",gp:"Thorekadanahalli"},
  {sno:116,code:614758,name:"Nitthur Kodihalli",dk:"",vao:"SOMANNA",gp:"Thorekadanahalli"},
  {sno:117,code:614759,name:"Karadahalli",dk:"",vao:"SIDDARAYAMALI",gp:"Lingapatna"},
  {sno:118,code:614760,name:"Vodeyarabasapura",dk:"Odubasappanadoddi",vao:"SOMANNA",gp:"Thorekadanahalli"},
  {sno:119,code:614761,name:"Handanahalli",dk:"",vao:"SOMANNA",gp:"Lingapatna"},
  {sno:120,code:614762,name:"Kodipura",dk:"",vao:"LATHA G",gp:"Thorekadanahalli"},
  {sno:121,code:614763,name:"Veerajithimmanadoddi",dk:"Vaddaradoddi",vao:"SOMASHEKAR P",gp:"Lingapatna"},
  {sno:122,code:614764,name:"Juganahalli",dk:"1)Doddegownadoddi 2)Benamanahalli",vao:"SOMASHEKAR P",gp:"Lingapatna"},
  {sno:123,code:614765,name:"Balehonniga",dk:"",vao:"SOMASHEKAR P",gp:"Dalavayikodihalli"},
  {sno:124,code:614766,name:"Dalavaikodihalli",dk:"",vao:"SOMASHEKAR P",gp:"Dalavayikodihalli"},
  {sno:125,code:614767,name:"Deveerahalli",dk:"",vao:"SOMASHEKAR P",gp:"Dalavayikodihalli"},
  {sno:126,code:614768,name:"Kempainadoddi",dk:"",vao:"SOMASHEKAR P",gp:"Dalavayikodihalli"},
  {sno:127,code:614769,name:"Nandipura",dk:"",vao:"SOMASHEKAR P",gp:"H Basavapura"},
  {sno:128,code:614770,name:"Gundapura",dk:"",vao:"LATHA G",gp:"H Basavapura"},
  {sno:129,code:614771,name:"Hosapetebasavapura",dk:"",vao:"LATHA G",gp:"H Basavapura"},
  {sno:130,code:614772,name:"Hagadur",dk:"",vao:"LATHA G",gp:"H Basavapura"},
  {sno:131,code:614773,name:"Shivanahalli",dk:"",vao:"LATHA G",gp:"H Basavapura"},
  {sno:132,code:614774,name:"Gollarahalli",dk:"",vao:"LATHA G",gp:"Bydarahalli"},
  {sno:133,code:614775,name:"Halaguru",dk:"1)Konnapura 2)Valageredoddi",vao:"SOMANNA",gp:"Halaguru"},
  {sno:134,code:614776,name:"Halaganadoddi",dk:"",vao:"LATHA G",gp:"Bydarahalli"},
  {sno:135,code:614777,name:"Chillapura",dk:"",vao:"LATHA G",gp:"Thorekadanahalli"},
  {sno:136,code:614778,name:"Thorekadanahalli",dk:"",vao:"BHASKAR S",gp:"Thorekadanahalli"},
  {sno:137,code:614779,name:"Nanjapura",dk:"",vao:"LATHA G",gp:"Bydarahalli"},
  {sno:138,code:614780,name:"Chikkayelachagere",dk:"",vao:"LATHA G",gp:"Bydarahalli"},
  {sno:139,code:614781,name:"Halagapura",dk:"",vao:"LATHA G",gp:"Thorekadanahalli"},
  {sno:140,code:614782,name:"Doddayelachagere",dk:"",vao:"LATHA G",gp:"Bydarahalli"},
  {sno:141,code:614783,name:"Madahalli",dk:"",vao:"LATHA G",gp:"Dugganahalli"},
  {sno:142,code:614784,name:"Ganalu",dk:"1)Masteradoddi 2)Kenchaboyidoddi 3)Kodlayyanadoddi 4)Beeruta 5)Konnapura Doddi 6)Tagadayyanadoddi 7)Ganagalu Hosadoddi 8)Karigowdanadoddi 9)Marijogidoddi 10)Beerappanadoddi 11)Guligowdanadoddi 12)Shakunidoddi 13)Byalamaradadoddi",vao:"NARASAPPA",gp:"Bydarahalli"},
  {sno:143,code:614785,name:"Bydarahalli",dk:"1)Krushnegowdanadoddi 2)Hosadoddi 3)Soligaradoddi",vao:"NARASAPPA",gp:"Bydarahalli"},
  {sno:144,code:651365,name:"Karalakattedoddi",dk:"",vao:"NARASAPPA",gp:"Bydarahalli"},
  {sno:145,code:614786,name:"Muthalakatte",dk:"",vao:"NARASAPPA",gp:"Bydarahalli"},
  {sno:146,code:614787,name:"Solaba",dk:"",vao:"NARASAPPA",gp:"Bydarahalli"},
  {sno:147,code:614788,name:"Basavanahalli",dk:"",vao:"SOMASHEKAR P",gp:"H Basavapura"},
  {sno:148,code:614789,name:"Basavana Betta Forest",dk:"",vao:"NARASAPPA",gp:"H Basavapura"},
  {sno:149,code:614790,name:"Dalanakatte",dk:"",vao:"NARASAPPA",gp:"Bydarahalli"},
  {sno:150,code:614791,name:"Basavegowdanadoddi",dk:"",vao:"NARASAPPA",gp:"Bydarahalli"},
  {sno:151,code:614792,name:"Talavadi",dk:"",vao:"NARASAPPA",gp:"Bydarahalli"},
  {sno:152,code:614793,name:"Majjigemallanahatti",dk:"",vao:"NARASAPPA",gp:"Bydarahalli"},
  {sno:153,code:614794,name:"Muthathi",dk:"",vao:"NARASAPPA",gp:"Bydarahalli"},
  {sno:154,code:614795,name:"Doddaboovalli",dk:"",vao:"RUKSAR FARHEEN",gp:"Kyathnahalli"},
  {sno:155,code:614796,name:"Kyathanahalli",dk:"",vao:"RUKSAR FARHEEN",gp:"Kyathnahalli"},
  {sno:156,code:614797,name:"Kundur",dk:"",vao:"SHRIKANTH KOTYAL",gp:"Kundur"},
  {sno:157,code:614798,name:"Shiramalli",dk:"",vao:"SHRIKANTH KOTYAL",gp:"Kundur"},
  {sno:158,code:614799,name:"Pandithahalli",dk:"",vao:"PRAVEEN T K",gp:"Pandithahalli"},
  {sno:159,code:614800,name:"Bachanahalli",dk:"",vao:"PRAVEEN T K",gp:"Pandithahalli"},
  {sno:160,code:614801,name:"Manchanapura",dk:"",vao:"MADHU M",gp:"Chottenahalli"},
  {sno:161,code:614802,name:"Chottanahalli",dk:"1)Kenchanadoddi 2)Chikkanadoddi",vao:"MADHU M",gp:"Chottenahalli"},
  {sno:162,code:651318,name:"Kunanakoppalu",dk:"",vao:"MADHU M",gp:"Chottenahalli"},
  {sno:163,code:614803,name:"Chandahalli",dk:"",vao:"MADHU M",gp:"Chottenahalli"},
  {sno:164,code:651422,name:"Varadarajaswamydoddi",dk:"",vao:"MADHU M",gp:"Chottenahalli"},
  {sno:165,code:614804,name:"Dabbahalli",dk:"",vao:"LAVANYA",gp:"Dhanaguru"},
  {sno:166,code:614805,name:"Netkal",dk:"Shimshapura",vao:"LAVANYA",gp:"Chottenahalli"},
  {sno:167,code:614806,name:"Mallikyathanahalli",dk:"Bluff(Shivanasamudra)",vao:"LANKESH H S",gp:"Hosahalli"},
  {sno:168,code:614807,name:"Belakavadi",dk:"1)Anthrayanapuradadoddi 2)Bannithalekoppalu",vao:"LANKESH H S",gp:"Belakavadi"},
  {sno:169,code:651558,name:"Javaganahalli",dk:"",vao:"LANKESH H S",gp:"Belakavadi"},
  {sno:170,code:614808,name:"Kiragasur",dk:"",vao:"LANKESH H S",gp:"Kaggalipura"},
  {sno:171,code:614809,name:"Vasuvalli",dk:"",vao:"SHRIKANTH KOTYAL",gp:"Kaggalipura"},
  {sno:172,code:614810,name:"Hokkarahalli",dk:"",vao:"SHRIKANTH KOTYAL",gp:"Kaggalipura"},
  {sno:173,code:614811,name:"Nanjanayanapura",dk:"",vao:"SHRIKANTH KOTYAL",gp:"B.G.Pura"},
  {sno:174,code:614812,name:"Dyavapatna",dk:"",vao:"SHRIKANTH KOTYAL",gp:"B.G.Pura"},
  {sno:175,code:614813,name:"Hosahalli",dk:"",vao:"PRAVEEN T K",gp:"Hosahalli"},
  {sno:176,code:614814,name:"Hebbani",dk:"",vao:"MADHU M",gp:"Pandithahalli"},
  {sno:177,code:614815,name:"Manchanahalli",dk:"",vao:"MADHU M",gp:"Pandithahalli"},
  {sno:178,code:614816,name:"Dasanadoddi",dk:"Hosadoddi",vao:"PRAVEEN T K",gp:"Pandithahalli"},
  {sno:179,code:614817,name:"Kanchugahalli",dk:"Narayanapura",vao:"SHRIKANTH KOTYAL",gp:"Kundur"},
  {sno:180,code:614818,name:"Malagalali",dk:"",vao:"SHRIKANTH KOTYAL",gp:"Kundur"},
  {sno:181,code:614819,name:"Thenkahalli",dk:"",vao:"SHRIKANTH KOTYAL",gp:"Kundur"},
  {sno:182,code:614820,name:"Kadabahalli",dk:"Kalyanikoppalu",vao:"MADHU M",gp:"Sarguru"},
  {sno:183,code:614821,name:"Mallinathapura",dk:"",vao:"MADHU M",gp:"Kyathnahalli"},
  {sno:184,code:614822,name:"Kaggala",dk:"",vao:"MADHU M",gp:"Kyathnahalli"},
  {sno:185,code:614823,name:"Kanikahalli",dk:"",vao:"SRINIVASAMURTHY",gp:"Sarguru"},
  {sno:186,code:614824,name:"Udape Boovalli",dk:"",vao:"SRINIVASAMURTHY",gp:"Sarguru"},
  {sno:187,code:614825,name:"Thigadahalli",dk:"Konanakoppalu",vao:"SUBHASH",gp:"Kundur"},
  {sno:188,code:614826,name:"Boppagowdanapura",dk:"Utturu",vao:"SUDEEP KUMAR V",gp:"B.G.Pura"},
  {sno:189,code:614827,name:"Muttanahalli",dk:"",vao:"SUBHASH",gp:"B.G.Pura"},
  {sno:190,code:614828,name:"Saraguru",dk:"1)Ainorahundi 2)Halagattekoppalu 3)Agasaragoddi 4)Manchanakoppalu",vao:"SRINIVASAMURTHY",gp:"Sarguru"},
  {sno:191,code:614829,name:"Hanavadi",dk:"",vao:"SRINIVASAMURTHY",gp:"Sarguru"},
  {sno:192,code:614830,name:"Purigali",dk:"Akkamallanahundi",vao:"SANJAY K",gp:"Purigali"},
  {sno:193,code:614831,name:"Hullamballi",dk:"",vao:"SRINIVASMURTHY",gp:"Purigali"},
  {sno:194,code:614832,name:"Chikka Abbagilu",dk:"",vao:"SRINIVASMURTHY",gp:"Purigali"},
  {sno:195,code:614833,name:"Chikkabagiluhanta",dk:"",vao:"SANJAY K",gp:"Purigali"},
  {sno:196,code:614834,name:"Maralahalli",dk:"",vao:"SRINIVASMURTHY",gp:"Purigali"},
  {sno:197,code:614835,name:"Ballagere",dk:"",vao:"SANJAY K",gp:"Sarguru"},
  {sno:198,code:614836,name:"Somanahalli",dk:"Bilijagalimole",vao:"SANJAY K",gp:"Sarguru"},
  {sno:199,code:614837,name:"Kodagahalli",dk:"",vao:"SUBHASH",gp:"B.G.Pura"},
  {sno:200,code:614838,name:"Haladasanahalli",dk:"",vao:"SRINIVASAMURTHY",gp:"Kaggalipura"},
  {sno:201,code:614839,name:"Kaggalipura",dk:"",vao:"SRINIVASAMURTHY",gp:"Kaggalipura"},
  {sno:202,code:651342,name:"Honaganahalli",dk:"",vao:"SRINIVASAMURTHY",gp:"Kaggalipura"},
];

// â”€â”€ Build flat rows (village + dakale sub-rows) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseDk(s) {
  if (!s || !s.trim()) return [];
  var m = s.match(/\d+\)\s*([^0-9)]+)/g);
  if (m && m.length > 1) return m.map(function(x){ return x.replace(/^\d+\)\s*/,"").trim(); }).filter(Boolean);
  return [s.trim()];
}

var ALL_ROWS = [];
RAW.forEach(function(v) {
  var dks = parseDk(v.dk);
  ALL_ROWS.push(Object.assign({}, v, {type:"village", rid:"V_"+v.code, dkNames:dks}));
  dks.forEach(function(d, i) {
    ALL_ROWS.push(Object.assign({}, v, {type:"dakale", rid:"D_"+v.code+"_"+i, dkName:d}));
  });
});

var VAOS = Array.from(new Set(RAW.map(function(v){return v.vao;}))).sort();
var GPS  = Array.from(new Set(RAW.map(function(v){return v.gp.trim();}))).sort();

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var STATE = {
  role: null,       // 'vao' | 'secretary'
  loginRole: "vao",
  uname: "",
  entries: {},      // rid â†’ {pV,hV,byV,atV, pS,hS,byS,atS}
  vis: [],          // filtered ALL_ROWS for current user
  toastTimer: null
};

// â”€â”€ LocalStorage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function lsGet(k) { try { var v=localStorage.getItem(k); return v?JSON.parse(v):null; } catch(e){ return null; } }
function lsSet(k,v) { try { localStorage.setItem(k,JSON.stringify(v)); } catch(e){} }

// Load persisted entries
var saved = lsGet("c27_entries");
if (saved) STATE.entries = saved;

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function $(id){ return document.getElementById(id); }
function show(id){ $(id).classList.remove("hidden"); }
function hide(id){ $(id).classList.add("hidden"); }

function flash(msg, type) {
  var t = $("toast");
  t.textContent = msg;
  t.className = "show " + (type||"ok");
  if (STATE.toastTimer) clearTimeout(STATE.toastTimer);
  STATE.toastTimer = setTimeout(function(){ t.className = ""; }, 3000);
}

function escHtml(s) {
  return String(s)
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;");
}

// â”€â”€ Login tab switch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(role) {
  STATE.loginRole = role;
  $("tab-vao").className = "rtab" + (role==="vao" ? " on" : "");
  $("tab-sec").className = "rtab" + (role==="secretary" ? " on" : "");
  $("sel-label").textContent = role === "vao" ? "VAO Name" : "GP Name";
  var sel = $("name-sel");
  sel.innerHTML = '<option value="">-- Select --</option>';
  var list = role === "vao" ? VAOS : GPS;
  list.forEach(function(x){
    var o = document.createElement("option");
    o.value = x; o.textContent = x;
    sel.appendChild(o);
  });
  $("login-err").className = "err-box";
}

// â”€â”€ Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doLogin() {
  var uname = $("name-sel").value;
  var pwd   = $("pwd-inp").value;
  var err   = $("login-err");
  if (!uname) { err.textContent="Please select a name."; err.className="err-box show"; return; }
  if (pwd !== PASSWORD) { err.textContent="Incorrect password."; err.className="err-box show"; return; }

  STATE.role  = STATE.loginRole;
  STATE.uname = uname;

  // Filter rows for this user
  STATE.vis = STATE.role === "vao"
    ? ALL_ROWS.filter(function(r){ return r.vao === uname; })
    : ALL_ROWS.filter(function(r){ return r.gp.trim() === uname; });

  // Update header
  $("hdr-role-badge").textContent = STATE.role === "vao" ? "ğŸ‘¤ VAO" : "ğŸ¢ Secretary";
  $("hdr-uname").textContent = uname;
  show("hdr-meta");

  // Update sidebar
  $("sb-title").textContent = STATE.role === "vao" ? "ğŸ‘¤ VAO Panel" : "ğŸ¢ Secretary Panel";
  $("sb-name").textContent  = uname;
  $("sb-role").textContent  = STATE.role === "vao" ? "VAO" : "GP Secretary";

  // Column headers
  var isVao = STATE.role === "vao";
  $("th-gp").textContent  = isVao ? "GP Name" : "VAO";
  $("th-pop").textContent = isVao ? "Present Population (VAO)" : "Present Population (Sec)";
  $("th-hh").textContent  = isVao ? "Total House Holds (VAO)"  : "Total House Holds (Sec)";

  // Sheet status
  if (SHEET_READY) {
    show("sheet-ok"); hide("sheet-no");
    show("stag-ok");  hide("stag-no");
  } else {
    hide("sheet-ok"); show("sheet-no");
    hide("stag-ok");  show("stag-no");
  }

  $("ctop-title").textContent = uname + " â€” Data Entry";
  $("ctop-sub").textContent   = STATE.vis.filter(function(r){return r.type==="village";}).length +
    " villages Â· Dakale Gramas shown as indented â†³ sub-rows";

  renderTable();
  updateProgress();

  hide("login-page");
  show("entry-page");
  $("pwd-inp").value = "";
}

// â”€â”€ Logout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doLogout() {
  STATE.role = null; STATE.uname = "";
  hide("entry-page"); show("login-page");
  hide("hdr-meta");
  $("name-sel").value = ""; $("pwd-inp").value = "";
  $("login-err").className = "err-box";
}

// â”€â”€ Progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateProgress() {
  var total = STATE.vis.length;
  var vCount= STATE.vis.filter(function(r){return r.type==="village";}).length;
  var done  = STATE.vis.filter(function(r){
    var e = STATE.entries[r.rid] || {};
    return STATE.role === "vao" ? (e.pV !== undefined && e.pV !== "") : (e.pS !== undefined && e.pS !== "");
  }).length;
  var pct = Math.round(done / Math.max(total,1) * 100);
  $("sb-villages").textContent = vCount;
  $("sb-total").textContent    = total;
  $("sb-done").textContent     = done + "/" + total;
  $("sb-done").className       = "ival " + (done === total ? "done" : "pend");
  $("pb-pct").textContent      = pct + "%";
  $("pfill").style.width       = pct + "%";
}

// â”€â”€ Render Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTable() {
  var tbody = $("tbl-body");
  var rows  = STATE.vis;
  var html  = "";

  rows.forEach(function(row) {
    var e    = STATE.entries[row.rid] || {};
    var isDk = row.type === "dakale";
    var isVao= STATE.role === "vao";

    // Saved values
    var pVal = isVao ? (e.pV !== undefined ? e.pV : "") : (e.pS !== undefined ? e.pS : "");
    var hVal = isVao ? (e.hV !== undefined ? e.hV : "") : (e.hS !== undefined ? e.hS : "");
    var pSaved = pVal !== "";
    var sv   = pSaved;

    var rowCls  = (isDk ? "drow" : "vrow") + (sv ? " sv" : "");
    var rid_esc = escHtml(row.rid);

    // â”€â”€ # cell
    var snoCell = isDk
      ? '<td><span class="arr">â†³</span></td>'
      : '<td><span class="sno-b">' + row.sno + '</span></td>';

    // â”€â”€ Name cell
    var nameCell;
    if (isDk) {
      nameCell = '<td><div class="dk-row"><div class="dk-dash"></div>' +
        '<span class="dk-lbl">' + escHtml(row.dkName) + '</span>' +
        '<span class="dk-tag">DAKALE</span></div></td>';
    } else {
      var sub = row.dkNames && row.dkNames.length > 0
        ? '<div class="dk-sub">' + row.dkNames.length + ' dakale grama' + (row.dkNames.length>1?'s':'') + ' â†“</div>'
        : '';
      nameCell = '<td><div class="vname">' + escHtml(row.name) + '</div>' + sub + '</td>';
    }

    // â”€â”€ GP/VAO cell
    var gpCell = isVao
      ? '<td><span class="gp-b">' + escHtml(row.gp.trim()) + '</span></td>'
      : '<td><span style="font-size:12px;color:#475569">' + escHtml(row.vao) + '</span></td>';

    // â”€â”€ Input classes
    var pCls = "ni" + (pSaved ? " hv" : "");
    var hSaved = isVao ? (e.hV !== undefined && e.hV !== "") : (e.hS !== undefined && e.hS !== "");
    var hCls = "ni" + (hSaved ? " hv" : "");

    // â”€â”€ Save button
    var saveBtn = sv
      ? '<span class="tick">âœ…</span>'
      : '<button class="sv-btn dim" onclick="saveRow(\'' + rid_esc + '\')">Save</button>';

    html += '<tr class="' + rowCls + '" id="tr-' + rid_esc + '">' +
      snoCell +
      '<td><span class="code-txt">' + row.code + '</span></td>' +
      nameCell +
      gpCell +
      '<td><input class="' + pCls + '" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="Enter" ' +
        'value="' + escHtml(pVal) + '" ' +
        'id="p-' + rid_esc + '" ' +
        'oninput="onInput(\'' + rid_esc + '\',\'p\',this.value)" /></td>' +
      '<td><input class="' + hCls + '" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="Enter" ' +
        'value="' + escHtml(hVal) + '" ' +
        'id="h-' + rid_esc + '" ' +
        'oninput="onInput(\'' + rid_esc + '\',\'h\',this.value)" /></td>' +
      '<td><div class="sc" id="sc-' + rid_esc + '">' +
        '<span class="dot hidden" id="dot-' + rid_esc + '"></span>' +
        saveBtn +
      '</div></td>' +
    '</tr>\n';
  });

  tbody.innerHTML = html;
}

// â”€â”€ Input handler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onInput(rid, field, raw) {
  var clean = raw.replace(/[^0-9]/g, "");
  var inp = $(field + "-" + rid);
  if (inp && inp.value !== clean) inp.value = clean;

  // Update save button to active
  var sc = $("sc-" + rid);
  if (sc) {
    var btn = sc.querySelector(".sv-btn");
    if (btn) btn.className = "sv-btn";
  }
  // Update input border
  if (inp) {
    var e = STATE.entries[rid] || {};
    var isVao = STATE.role === "vao";
    var existingVal = field === "p"
      ? (isVao ? e.pV : e.pS)
      : (isVao ? e.hV : e.hS);
    inp.className = "ni" + (clean !== "" || existingVal ? " hv" : "");
  }
}

// â”€â”€ Save row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveRow(rid) {
  var pInp = $("p-" + rid);
  var hInp = $("h-" + rid);
  if (!pInp) return;

  var pVal = pInp.value.replace(/[^0-9]/g,"");
  var hVal = hInp ? hInp.value.replace(/[^0-9]/g,"") : "";

  if (pVal === "" && hVal === "") {
    flash("âš  Please enter Population or House Holds before saving", "err");
    return;
  }

  var e   = STATE.entries[rid] || {};
  var up  = Object.assign({}, e);
  var now = new Date().toLocaleString("en-IN");

  if (STATE.role === "vao") {
    if (pVal !== "") up.pV = pVal;
    if (hVal !== "") up.hV = hVal;
    up.byV = STATE.uname; up.atV = now;
  } else {
    if (pVal !== "") up.pS = pVal;
    if (hVal !== "") up.hS = hVal;
    up.byS = STATE.uname; up.atS = now;
  }

  STATE.entries[rid] = up;
  lsSet("c27_entries", STATE.entries);

  // Find row data for label + push
  var row = ALL_ROWS.find(function(r){ return r.rid === rid; });
  var label = row ? (row.type === "dakale" ? row.dkName : row.name) : rid;
  flash("âœ“ Saved: " + label);

  // Update row UI
  var tr = $("tr-" + rid);
  if (tr) {
    tr.className = (row && row.type==="dakale" ? "drow" : "vrow") + " sv";
  }
  // Inputs go green
  if (pInp) pInp.className = "ni hv";
  if (hInp) hInp.className = "ni hv";
  // Replace button with tick
  var sc = $("sc-" + rid);
  if (sc) sc.innerHTML = '<span class="dot hidden" id="dot-'+rid+'"></span><span class="tick">âœ…</span>';

  updateProgress();

  // Push to Google Sheets
  if (row) pushToSheet(rid, row, up);
}

// â”€â”€ Push to Sheets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pushToSheet(rid, row, up) {
  if (!SHEET_READY) return;
  var dotEl = $("dot-" + rid);
  if (dotEl) { dotEl.className = "dot dot-spin"; dotEl.classList.remove("hidden"); }

  var payload = JSON.stringify({
    action:      "upsertRow",
    rowId:       rid,
    code:        row.code,
    villageName: row.name,
    rowType:     row.type,
    dakaleGrama: row.type === "dakale" ? row.dkName : "",
    vao:         row.vao,
    gp:          row.gp,
    popVAO:      up.pV  !== undefined ? up.pV  : "",
    hhVAO:       up.hV  !== undefined ? up.hV  : "",
    savedByVAO:  up.byV || "",
    vaoAt:       up.atV || "",
    popSec:      up.pS  !== undefined ? up.pS  : "",
    hhSec:       up.hS  !== undefined ? up.hS  : "",
    savedBySec:  up.byS || "",
    secAt:       up.atS || ""
  });

  fetch(SHEET_URL, {
    method:  "POST",
    mode:    "no-cors",
    headers: {"Content-Type":"application/json"},
    body:    payload
  }).then(function() {
    var d = $("dot-" + rid);
    if (d) { d.className = "dot dot-ok"; }
  }).catch(function() {
    var d = $("dot-" + rid);
    if (d) { d.className = "dot dot-err"; }
    flash("âš  Sheet sync failed â€” data saved locally", "err");
  });
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Populate VAO dropdown on load
switchTab("vao");
</script>
</body>
</html>